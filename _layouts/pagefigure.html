---
layout: pagegallery
---

<head>
    <link href="{{ '/assets/js/lightbox.css' | relative_url }}" rel="stylesheet" />
    <style>
        /* 基本样式 */
        .figure-grid {
            margin: 0 auto;
            /* Masonry JS 会负责定位 */
            opacity: 0;
            /* 初始隐藏，等待 JS 初始化后显示 */
            transition: opacity 0.5s ease-in-out;
        }

        .figure-grid.initialized {
            opacity: 1;
            /* 初始化后淡入 */
        }

        /* 用于 Masonry 计算列宽的 Sizer 元素 */
        .figure-grid-sizer {
            width: 33.333%;
        }

        @media screen and (max-width: 768px) {
            .figure-grid-sizer {
                width: 50%;
            }
        }

        @media screen and (max-width: 480px) {
            .figure-grid-sizer {
                width: 100%;
            }
        }

        /* 网格项样式 */
        .figure-grid-item {
            width: 33.333%;
            /* 设置左右内边距为 5px，上下为 0 */
            padding: 0 5px;
            box-sizing: border-box;
            /* 设置下方外边距为 10px */
            margin-bottom: 10px;
            float: left;
        }

        @media screen and (max-width: 768px) {
            .figure-grid-item {
                width: 50%;
            }
        }

        @media screen and (max-width: 480px) {
            .figure-grid-item {
                width: 100%;
            }
        }

        .figure-grid-item img {
            display: block;
            /* 移除图片下方的额外空间 */
            width: 100%;
            /* 使图片填充项 */
            height: auto;
            /* 保持宽高比 */
            background-color: #eee;
            /* 浅灰色占位背景 */
            min-height: 150px;
            /* 加载前的最小高度 */
            transition: opacity 0.4s ease-in-out, transform 0.3s ease-in-out;
            opacity: 0;
            /* 初始透明，为淡入效果准备 */
            border-radius: 4px;
            /* 轻微圆角 */
        }

        .figure-grid-item img.loaded {
            opacity: 1;
            /* 加载后淡入 */
            background-color: transparent;
            /* 移除占位背景 */
        }

        /* 图片呼吸/放大效果 */
        .figure-grid-item a:hover img {
            transform: scale(1.05);
            /* 悬停时放大图片 */
        }

        /* 确保链接没有下划线 */
        .figure-grid a,
        .figure-grid a:hover,
        .figure-grid a:visited {
            text-decoration: none;
            border: none;
            outline: none;
            display: block;
            /* 使链接容器成为块级元素 */
            background: none;
            /* 移除可能的背景 */
        }

        .figure-grid a::after {
            /* 移除主题可能添加的下划线 */
            content: none !important;
        }

        /* Lightbox 相关样式调整 (可选) */
        .lb-dataContainer {
            border-bottom-left-radius: 4px;
            border-bottom-right-radius: 4px;
        }

        .lb-outerContainer {
            border-radius: 4px;
        }

        .lb-nav a.lb-prev,
        .lb-nav a.lb-next {
            opacity: 0.7;
            transition: opacity 0.2s;
        }

        .lb-nav a.lb-prev:hover,
        .lb-nav a.lb-next:hover {
            opacity: 1;
        }

        /* 清除浮动 */
        .figure-grid:after {
            content: '';
            display: block;
            clear: both;
        }
    </style>
</head>

<body>
    {{ content }}

    <script src="{{ '/assets/js/lozad.js' | relative_url }}"></script>
    <script src="{{ '/assets/js/masonry.pkgd.min.js' | relative_url }}"></script>
    <script src="{{ '/assets/js/imagesloaded.pkgd.min.js' | relative_url }}"></script>
    <script src="{{ '/assets/js/lightbox-plus-jquery.js' | relative_url }}"></script>

    <script>
        try {
            console.log("DEBUG: pagefigure.html script executing. Step 1: Script start.");

            // ---- State Setup (Simplified) ----
            console.log("DEBUG: Step 2: Setting up window.galleryState (simplified).");
            window.galleryState = window.galleryState || {};
            console.log("DEBUG: Step 3: window.galleryState setup complete.");

            // ---- Function Definitions (Simplified) ----
            console.log("DEBUG: Step 4: Defining placeholder functions.");
            function initializeGallery() {
                console.log("########## DEBUG: initializeGallery CALLED (Simplified) ##########");
                const grid = document.querySelector('.figure-grid');
                if (grid) {
                    console.log("DEBUG: Found .figure-grid element (Simplified).");
                    // Do nothing else for now
                } else {
                    console.warn("DEBUG: Did NOT find .figure-grid element (Simplified).");
                }
            }

            function setupMutationObserver() {
                console.log("########## DEBUG: setupMutationObserver CALLED (Simplified) ##########");
                // Try to initialize immediately
                if (initializeGallery()) {
                    console.log("DEBUG: Initial attempt in setupMutationObserver worked (Simplified).");
                } else {
                    console.log("DEBUG: Initial attempt in setupMutationObserver failed, would normally start observer (Simplified).");
                    // Do not actually start observer for this test
                }
            }
            console.log("DEBUG: Step 5: Placeholder functions defined.");

            // ---- Initialization Logic (Simplified) ----
            console.log("DEBUG: Step 6: Starting simplified initialization logic.");

            // Attempt immediate initialization or setup observer
            // Note: Still wrapped in the outer try-catch
            setupMutationObserver();
            console.log("DEBUG: Step 7: Initial setupMutationObserver call complete (Simplified).");


            // Fallback for full page loads (Ctrl+R)
            // Note: Still wrapped in the outer try-catch
            window.addEventListener('load', () => {
                try {
                    console.log("########## DEBUG: WINDOW.LOAD CALLBACK FIRED! (Simplified) ##########");
                    // Only initialize if the observer hasn't already succeeded
                    if (!window.galleryState.isGalleryInitialized) { // Note: this flag is never set to true in simplified version
                        console.warn("WARN: Calling initializeGallery from load event (Simplified).");
                        initializeGallery();
                    }
                } catch (loadError) {
                    console.error("ERROR inside window.load listener:", loadError);
                }
            });
            console.log("DEBUG: Step 8: Fallback window.load listener attached (Simplified).");

            console.log("DEBUG: Step 9: End of simplified pagefigure.html script block.");

        } catch (globalError) {
            // Catch any error that might occur anywhere between Step 1 and Step 9
            console.error("########## FATAL ERROR CAUGHT IN GLOBAL TRY-CATCH ##########", globalError);
        }

        /*
        // ---- ORIGINAL CODE COMMENTED OUT FOR TESTING ----

        // function checkLibraries() { ... }
        // function initializeGallery() { ... (original complex version) ... }
        // function setupMutationObserver() { ... (original complex version) ... }
        // function cleanupGallery() { ... }

        // console.log("DEBUG: Step 5: Helper functions defined.");
        // console.log("DEBUG: Step 6: Starting initialization logic.");
        // setupMutationObserver();
        // console.log("DEBUG: Step 7: Initial setupMutationObserver call complete.");
        // window.addEventListener('load', () => { ... (original complex version) ... });
        // console.log("DEBUG: Step 8: Fallback window.load listener attached.");
        // console.log("DEBUG: Step 9: End of pagefigure.html script block.");
        */

    </script>
</body>