---
layout: page
---

<head>
</head>

<body>
    <div class="tab-container">
        <div class="tab-nav">
            <button class="tab-btn active" data-year="All">All</button>
            {% assign years = site.galleries | map: "year" | uniq %}
            {% assign sorted_years = '' | split: '' %}
            {% assign pre_2018_year = '' %}

            {% for year in years %}
            {% if year == "pre-2018" %}
            {% assign pre_2018_year = year %}
            {% else %}
            {% assign sorted_years = sorted_years | push: year %}
            {% endif %}
            {% endfor %}

            {% assign sorted_years = sorted_years | sort | reverse %}

            {% if pre_2018_year != '' %}
            {% assign sorted_years = sorted_years | push: pre_2018_year %}
            {% endif %}

            {% for year in sorted_years %}
            <button class="tab-btn" data-year="{{ year }}">{{ year }}</button>
            {% endfor %}
        </div>

        <input type="text" id="searchInput" placeholder="Search for locations...">

        <div id="gallery-content">
            {% for year in sorted_years %}
            <div id="{{ year }}" class="tab-content is-visible">
                <h2>{{ year }}</h2>
                <div class="gallery-grid">
                    {% assign galleries_by_year = site.galleries | where: "year", year %}
                    {% for gallery in galleries_by_year %}
                    {% for item in gallery.items %}
                    <div class="card">
                        <div class="image-overlay-container">
                            <a href="{{ item.url }}">
                                <img src="{{ item.image }}" />
                                <div class="card-text">{{ item.title }}</div>
                            </a>
                        </div>
                    </div>
                    {% endfor %}
                    {% endfor %}
                </div>
            </div>
            {% endfor %}
        </div>

        <div id="search-results" class="gallery-grid" style="display: none;"></div>
    </div>

    <script>
        /*
        ================================================================================
          Gallery Page Script
          - Handles tab switching for years via event delegation.
          - Handles client-side search/filtering of galleries.
          - PJAX-aware: Initializes on both direct load and dynamic navigation.
          - Inspired by pagefigure.html for robust PJAX handling.
        ================================================================================
        */
        function initGalleryPage() {
            const tabContainer = document.querySelector('.tab-container');

            /* If the gallery elements don't exist on the page, do nothing. */
            if (!tabContainer) {
                return;
            }

            /* Prevent re-initialization on the same DOM tree */
            if (tabContainer.dataset.galleryInitialized) {
                return;
            }
            tabContainer.dataset.galleryInitialized = 'true';

            const searchInput = document.getElementById('searchInput');
            const galleryContent = document.getElementById('gallery-content');
            const searchResults = document.getElementById('search-results');
            const tabNav = tabContainer.querySelector('.tab-nav');

            const filterGalleries = () => {
                const filter = searchInput.value.toLowerCase();

                if (filter.length > 0) {
                    galleryContent.style.display = 'none';
                    searchResults.innerHTML = '';

                    const allCards = galleryContent.querySelectorAll('.card');
                    let matchesFound = false;

                    allCards.forEach(card => {
                        const title = card.querySelector('.card-text');
                        if (title) {
                            const txtValue = title.textContent || title.innerText;
                            if (txtValue.toLowerCase().indexOf(filter) > -1) {
                                searchResults.appendChild(card.cloneNode(true));
                                matchesFound = true;
                            }
                        }
                    });

                    if (!matchesFound) {
                        searchResults.innerHTML = '<p style="text-align: center; width: 100%;">No locations found.</p>';
                    }
                    searchResults.style.display = 'grid';
                } else {
                    galleryContent.style.display = 'block';
                    searchResults.style.display = 'none';
                    searchResults.innerHTML = '';
                }
            };

            const openYear = (evt, yearName) => {
                let i, tabcontent, tablinks;
                tabcontent = tabContainer.getElementsByClassName("tab-content");
                for (i = 0; i < tabcontent.length; i++) {
                    tabcontent[i].classList.remove("is-visible");
                }
                tablinks = tabContainer.getElementsByClassName("tab-btn");
                for (i = 0; i < tablinks.length; i++) {
                    tablinks[i].classList.remove("active");
                }

                if (yearName === "All") {
                    for (i = 0; i < tabcontent.length; i++) {
                        tabcontent[i].classList.add("is-visible");
                    }
                } else {
                    const targetElement = document.getElementById(yearName);
                    if (targetElement) {
                        targetElement.classList.add("is-visible");
                    }
                }

                /* Use evt.target which is the clicked element (.tab-btn) */
                evt.target.classList.add("active");

                searchInput.value = '';
                filterGalleries();
            };

            /* Attach event listeners using delegation */
            searchInput.addEventListener('keyup', filterGalleries);
            tabNav.addEventListener('click', (clickEvent) => {
                /* Check if a tab button was clicked */
                if (clickEvent.target.matches('.tab-btn')) {
                    openYear(clickEvent, clickEvent.target.dataset.year);
                }
            });

            /* Set initial state for the 'All' tab on every load */
            const allButton = tabContainer.querySelector('.tab-btn[data-year="All"]');
            if (allButton) {
                /* Here, the event object is synthetic. We need `target` for openYear. */
                openYear({ target: allButton }, 'All');
            }
        }

        function deferredInit() {
            requestAnimationFrame(initGalleryPage);
        }

        /* Initialize for normal page loads */
        document.addEventListener('DOMContentLoaded', deferredInit, { once: true });
        /* Initialize for Hydejack's PJAX navigation (using 'hy:load' from pagefigure.html) */
        window.addEventListener('hy:load', deferredInit);

        /* Ensure initialization when script loads after DOM is ready (e.g., PJAX swap) */
        if (document.readyState === 'interactive' || document.readyState === 'complete') {
            deferredInit();
        }
    </script>

    {{ content }}
</body>