---
layout: page
---

<div class="tab-container" data-gallery-page="true">
    <div class="tab-nav">
        <button class="tab-btn active" data-year="All" onclick="GalleryPage.openYear(event, 'All')">
            <span class="en">All</span>
            <span class="zh">全部</span>
        </button>

        {% assign raw_years = site.galleries | map: "year" | uniq %}
        {% assign numeric_years = "" | split: "" %}
        {% assign string_years = "" | split: "" %}

        {% for y in raw_years %}
        {% assign y_num = y | plus: 0 %}
        {% if y_num > 0 %}
        {% assign numeric_years = numeric_years | push: y %}
        {% else %}
        {% assign string_years = string_years | push: y %}
        {% endif %}
        {% endfor %}

        {% assign numeric_years = numeric_years | sort | reverse %}
        {% assign string_years = string_years | sort %}

        {% assign sorted_years = numeric_years | concat: string_years %}

        <!-- 1. Calculate Dynamic Blocks for years > 2020 -->
        {% assign block_ids = "" %}
        {% for y in sorted_years %}
        {% assign y_num = y | plus: 0 %}
        {% if y_num > 2020 %}
        <!-- (y-1)/5 to get block index. e.g. 2021..2025 -> 404, 2026..2030 -> 405 -->
        {% assign bid = y_num | minus: 1 | divided_by: 5 %}
        {% assign block_ids = block_ids | append: "," | append: bid %}
        {% endif %}
        {% endfor %}

        {% assign unique_bids = block_ids | remove_first: "," | split: "," | uniq %}

        <!-- 2. Render Dynamic Dropdowns -->
        {% for bid in unique_bids %}
        {% assign current_block_years = "" | split: "" %}

        {% for y in sorted_years %}
        {% assign y_num = y | plus: 0 %}
        {% if y_num > 2020 %}
        {% assign this_bid = y_num | minus: 1 | divided_by: 5 | append: "" %}
        {% if this_bid == bid %}
        {% assign current_block_years = current_block_years | push: y %}
        {% endif %}
        {% endif %}
        {% endfor %}

        {% if current_block_years.size > 0 %}
        {% assign max_y = current_block_years.first %}
        {% assign min_y = current_block_years.last %}
        {% assign label = min_y | append: "-" | append: max_y %}
        {% if min_y == max_y %}
        {% assign label = min_y %}
        {% endif %}

        <div class="dropdown">
            {% assign year_list_str = current_block_years | join: "," %}
            <button class="tab-btn dropbtn" onclick="GalleryPage.openGroup(event, '{{ year_list_str }}')">{{ label
                }}</button>
            <div class="dropdown-content">
                {% for y in current_block_years %}
                <button class="tab-btn" onclick="GalleryPage.openYear(event, '{{ y }}')">{{ y }}</button>
                {% endfor %}
            </div>
        </div>
        {% endif %}
        {% endfor %}

        <!-- 3. Render 'Before 2021' Group for years <= 2020 -->
        {% assign group_older = "" | split: "" %}
        {% for y in sorted_years %}
        {% assign y_num = y | plus: 0 %}
        <!-- Check for string years (0) or years <= 2020 -->
        {% if y == "pre-2018" or y_num <= 2020 %} {% assign group_older=group_older | push: y %} {% endif %} {% endfor
            %} {% if group_older.size> 0 %}
            <div class="dropdown">
                {% assign year_list_older = group_older | join: "," %}
                <button class="tab-btn dropbtn" onclick="GalleryPage.openGroup(event, '{{ year_list_older }}')">
                    <span class="en">Before 2021</span>
                    <span class="zh">2021之前</span>
                </button>
                <div class="dropdown-content">
                    {% for y in group_older %}
                    <button class="tab-btn" onclick="GalleryPage.openYear(event, '{{ y }}')">{{ y }}</button>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <button class="tab-btn active-map" id="map-toggle-btn" onclick="GalleryPage.toggleMap(event)">
                <span class="en">Map</span>
                <span class="zh">地图</span>
            </button>
    </div>

    <div class="search-container" style="position:relative;">
        <input type="text" id="searchInput" class="en" placeholder="Search for locations..."
            onkeyup="GalleryPage.filterGalleries()">
        <input type="text" id="searchInputZh" class="zh" placeholder="搜索地点..." onkeyup="GalleryPage.filterGalleries()"
            style="display:none;">
    </div>
    <!-- Simple script to toggle search input visibility based on body class -->
    <style>
        body.lang-zh #searchInput.en {
            display: none;
        }

        body.lang-zh #searchInputZh.zh {
            display: block !important;
        }

        body.lang-en #searchInputZh.zh {
            display: none;
        }

        body.lang-en #searchInput.en {
            display: block !important;
        }
    </style>

    <!-- Map Container moved outside tab content and visible by default -->
    <div id="Map" class="map-section" style="display: block; margin-bottom: 20px;">
        <div id="map-container" style="height: 400px; width: 100%;"></div>
    </div>

    <div id="gallery-content">
        {% for year in sorted_years %}
        <div id="{{ year }}" class="tab-content is-visible">
            <h2>
                <span class="en">{{ year }}</span>
                <span class="zh">{{ year }}年</span>
            </h2>
            <div class="gallery-grid">
                {% assign galleries_by_year = site.galleries | where: "year", year %}
                {% for gallery in galleries_by_year %}
                {% for item in gallery.items %}
                <div class="card">
                    <div class="image-overlay-container">
                        <a href="{{ item.url }}">
                            <img class="lozad" data-src="{{ item.image }}"
                                src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxIDEiPjwvc3ZnPg==" />
                            <div class="card-text">
                                <span class="en">{{ item.title }}</span>
                                <span class="zh">{{ item.title_zh | default: item.title }}</span>
                            </div>
                        </a>
                    </div>
                </div>
                {% endfor %}
                {% endfor %}
            </div>
        </div>
        {% endfor %}
    </div>

    <div id="search-results" class="gallery-grid" style="display: none;"></div>
    <script id="gallery-data" type="application/json">
        {{ site.galleries | jsonify }}
    </script>
</div>

<style>
    .lozad {
        opacity: 0;
        transition: opacity 0.3s ease-in-out;
    }
</style>

{{ content }}